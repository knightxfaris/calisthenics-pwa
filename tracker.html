<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Calisthenics Tracker</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBGDV3F8YZ6-bqtkx4AMbEt-Sy8PYlPkUU",
      authDomain: "calisthenics-tracker-45570.firebaseapp.com",
      projectId: "calisthenics-tracker-45570",
      storageBucket: "calisthenics-tracker-45570.firebasestorage.app",
      messagingSenderId: "330168228790",
      appId: "1:330168228790:web:c24cfe79e669e6237dbf17",
      measurementId: "G-Y3KN5D0DCH"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.saveToCloud = async function(user, date, key, value) {
      const ref = doc(db, "users", user);
      const snap = await getDoc(ref);
      let data = snap.exists() ? snap.data() : {};
      if (!data[date]) data[date] = {};
      data[date][key] = value;
      await setDoc(ref, data);
    }

    window.loadFromCloud = async function(user, date, key) {
      const ref = doc(db, "users", user);
      const snap = await getDoc(ref);
      if (snap.exists() && snap.data()[date]) {
        return snap.data()[date][key] || "";
      }
      return "";
    }

    window.onload = async function() {
      const user = localStorage.getItem("username") || "Faris";
      const today = new Date().toISOString().split('T')[0];
      document.getElementById("dateDisplay").textContent = `User: ${user} | ${today}`;
      generateUI(today, user);
      populateDatePicker();
      flatpickr("#datePicker", {
  dateFormat: "Y-m-d",
  onChange: function(selectedDates, dateStr) {
    generateUI(dateStr, localStorage.getItem("username") || "Faris");
  }
});
    };

    const schedule = {
      "Day 1 - Full Body": [
        { name: "Jumping Jacks (3x30)", gif: "jumping-jacks.gif" },
        { name: "Incline Push-ups (3x10)", gif: "incline-pushups.gif" },
        { name: "Wall Sit (3x45s)", gif: "wall-sit.gif" },
        { name: "Mountain Climbers (3x20)", gif: "mountain-climbers.gif" }
      ],
      "Day 2 - Core": [
        { name: "Plank (3x30s)", gif: "plank.gif" },
        { name: "Crunches (3x20)", gif: "crunches.gif" },
        { name: "Leg Raises (3x15)", gif: "leg-raises.gif" },
        { name: "Flutter Kicks (3x30s)", gif: "flutter-kicks.gif" }
      ],
      "Day 3 - Lower Body": [
        { name: "Squats (3x15)", gif: "squats.gif" },
        { name: "Lunges (3x10/leg)", gif: "lunges.gif" },
        { name: "Calf Raises (3x20)", gif: "calf-raises.gif" },
        { name: "Glute Bridges (3x15)", gif: "glute-bridges.gif" }
      ],
      "Day 4 - Upper Body": [
        { name: "Wall Push-ups (3x15)", gif: "wall-pushups.gif" },
        { name: "Arm Circles (3x30s)", gif: "arm-circles.gif" },
        { name: "Superman Hold (3x20s)", gif: "superman-hold.gif" },
        { name: "Chair Dips (3x10)", gif: "chair-dips.gif" }
      ]
    };

    async function generateUI(date, user) {
      const container = document.getElementById("container");
      container.innerHTML = "";
      for (let day in schedule) {
        let dayDiv = document.createElement("div");
        dayDiv.className = "day";
        let header = `<h3>${day}</h3>`;
        let content = "";

        for (let i = 0; i < schedule[day].length; i++) {
          const ex = schedule[day][i];
          const repKey = `${date}-${day}-${i}-reps`;
          const setKey = `${date}-${day}-${i}-sets`;
          const reps = await loadFromCloud(user, date, repKey);
          const sets = await loadFromCloud(user, date, setKey);

          content += `
            <div class="exercise">
              <p><strong>${ex.name}</strong></p>
              <img src="${ex.gif}" alt="${ex.name}">
              <div class="input-group">
                <input type="number" inputmode="numeric" pattern="[0-9]*" placeholder="Reps" value="${reps}" onchange="save('${user}', '${date}', '${repKey}', this.value)">
                <input type="number" inputmode="numeric" pattern="[0-9]*" placeholder="Sets" value="${sets}" onchange="save('${user}', '${date}', '${setKey}', this.value)">
                <button onclick="save('${user}', '${date}', '${repKey}', this.parentElement.querySelectorAll('input')[0].value); save('${user}', '${date}', '${setKey}', this.parentElement.querySelectorAll('input')[1].value)">ðŸ’¾ Save This</button>
              </div>
            </div>
          `;
        }

        dayDiv.innerHTML = header + content;
        container.appendChild(dayDiv);
      }
    }

    function save(user, date, key, value) {
      if (value >= 0) {
        saveToCloud(user, date, key, value);
      }
    }

    function populateDatePicker() {
      let dates = JSON.parse(localStorage.getItem("savedDates") || "[]");
      let picker = document.getElementById("datePicker");
      picker.innerHTML = '<option value="">ðŸ“† Select a date</option>';
      dates.forEach(d => {
        picker.innerHTML += `<option value="${d}">${d}</option>`;
      });
    }

    function generateDatePicker() {
      const picker = document.getElementById("datePicker");
      const min = new Date(2025, 0, 1);
      const max = new Date(2030, 11, 31);
      for (let d = new Date(min); d <= max; d.setDate(d.getDate() + 1)) {
        const dateString = d.toISOString().split('T')[0];
        const option = document.createElement("option");
        option.value = dateString;
        option.textContent = dateString;
        picker.appendChild(option);
      }
    }
  
        document.addEventListener('gesturestart', function (e) {
          e.preventDefault();
        });
        </script>
  <style>
    body { background: #0e0e0e; color: white; font-family: Arial; padding: 20px; }
    .day { background: #1e1e1e; border-radius: 10px; padding: 15px; margin-bottom: 30px; }
    .exercise { margin-bottom: 20px; }
    .input-group { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 5px; }
    input { padding: 8px; touch-action: manipulation; border: 1px solid #444; border-radius: 5px; background: #1d1d1d; color: white; }
    button { background: #333; color: white; border: none; border-radius: 5px; padding: 10px 15px; cursor: pointer; }
    button:hover { background: #444; }
    select { padding: 10px; border-radius: 5px; background: #1d1d1d; color: white; border: none; }
  </style>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body>
  <h2>Calisthenics Tracker - Faris</h2>
  <div id="dateDisplay"></div>
  <input id="datePicker" onchange="generateUI(this.value, localStorage.getItem('username') || 'Faris')">
    <option value="">ðŸ“… Select a date</option>
  </select>
  <div id="container"></div>
</body>
</html>
